#!/usr/bin/env bash
set -euo pipefail

BACKUP_DIR="$HOME/.me.bkp"

if [[ ! -d "$BACKUP_DIR" ]]; then
    echo "Error: Backup not found at $BACKUP_DIR"
    echo "Cannot rollback without backup"
    exit 1
fi

echo "This will restore your original configs from $BACKUP_DIR"
read -p "Continue? (y/N) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Aborted"
    exit 0
fi

# Remove symlinks
echo "Removing symlinks..."
rm -f ~/.claude/agents ~/.claude/commands ~/.claude/skills ~/.claude/prompts
rm -f ~/.claude/hooks ~/.claude/CLAUDE.md
rm -f ~/.config/lvim
rm -f ~/.iterm

# Restore original files
echo "Restoring original files..."
cp -R "$BACKUP_DIR"/* ~/

echo "âœ“ Rolled back to pre-.me state"
